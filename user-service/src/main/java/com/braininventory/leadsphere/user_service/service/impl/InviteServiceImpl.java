package com.braininventory.leadsphere.user_service.service.impl;import com.braininventory.leadsphere.user_service.dto.InviteResponseDto;import com.braininventory.leadsphere.user_service.dto.UserRequestDto;import com.braininventory.leadsphere.user_service.entity.Invite;import com.braininventory.leadsphere.user_service.enums.InviteStatus;import com.braininventory.leadsphere.user_service.repository.InviteRepository;import com.braininventory.leadsphere.user_service.security.TokenGenerator;import com.braininventory.leadsphere.user_service.service.InviteService;import com.braininventory.leadsphere.user_service.service.MailService;import com.braininventory.leadsphere.user_service.service.UserService;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;import java.time.LocalDateTime;@Servicepublic class InviteServiceImpl implements InviteService {    private final InviteRepository inviteRepository;    private final TokenGenerator tokenGenerator;    private final UserService userService;    private final MailService mailService;    // Inject all dependencies via constructor    public InviteServiceImpl(InviteRepository inviteRepository,                             TokenGenerator tokenGenerator,                             UserService userService,                             MailService mailService) {        this.inviteRepository = inviteRepository;        this.tokenGenerator = tokenGenerator;        this.userService = userService;        this.mailService = mailService;    }    public InviteResponseDto createInvite(String email) {        String token = tokenGenerator.generateSecureToken();        Invite invite = new Invite();        invite.setEmail(email);        invite.setToken(token);        invite.setStatus(InviteStatus.PENDING);        invite.setExpiryDate(LocalDateTime.now().plusDays(7));       // invite.setInvitedBy(inviter);        inviteRepository.save(invite);        // TODO: send email with invite link        // Send actual email        mailService.sendInviteEmail(email, token);        return new InviteResponseDto(email, token, "Invite created successfully");    }    public void acceptInvite(String token, UserRequestDto newUserRequest) {        Invite invite = inviteRepository.findByToken(token)                .orElseThrow(() -> new RuntimeException("Invalid invite token"));        if (invite.getExpiryDate().isBefore(LocalDateTime.now())) {            throw new RuntimeException("Invite expired");        }        invite.setStatus(InviteStatus.ACCEPTED);        inviteRepository.save(invite);        userService.createSalesUser(newUserRequest);    }    @Override    public InviteResponseDto getInviteStatus(Long id) {        Invite invite = inviteRepository.findById(id)                .orElseThrow(() -> new RuntimeException("Invite not found with id: " + id));        return new InviteResponseDto(                invite.getEmail(),                invite.getToken(),                "Status: " + invite.getStatus().name()        );    }}