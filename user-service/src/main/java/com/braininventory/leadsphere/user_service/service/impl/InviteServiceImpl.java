package com.braininventory.leadsphere.user_service.service.impl;import com.braininventory.leadsphere.user_service.dto.InviteResponseDto;import com.braininventory.leadsphere.user_service.dto.UserRequestDto;import com.braininventory.leadsphere.user_service.entity.Invite;import com.braininventory.leadsphere.user_service.enums.InviteStatus;import com.braininventory.leadsphere.user_service.exception.*;import com.braininventory.leadsphere.user_service.repository.InviteRepository;import com.braininventory.leadsphere.user_service.repository.UserRepository;import com.braininventory.leadsphere.user_service.security.TokenGenerator;import com.braininventory.leadsphere.user_service.service.InviteService;import com.braininventory.leadsphere.user_service.service.MailService;import com.braininventory.leadsphere.user_service.service.UserService;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;import java.time.LocalDateTime;@Servicepublic class InviteServiceImpl implements InviteService {    private final InviteRepository inviteRepository;    private final TokenGenerator tokenGenerator;    private final UserService userService;    private final MailService mailService;    // Inject all dependencies via constructor    public InviteServiceImpl(InviteRepository inviteRepository,                             TokenGenerator tokenGenerator,                             UserService userService,                             MailService mailService) {        this.inviteRepository = inviteRepository;        this.tokenGenerator = tokenGenerator;        this.userService = userService;        this.mailService = mailService;    }    public void createInvite(String email) {        Object existingUser = userService.findByEmail(email);        if (existingUser != null) {            throw new DuplicateInviteException(email);        }        String TempPassword = tokenGenerator.generateTemporaryPassword();  // random password        Invite invite = new Invite();        invite.setEmail(email);        invite.setPassword(TempPassword);        invite.setCreatedAt(LocalDateTime.now());        inviteRepository.save(invite);        UserRequestDto userRequestDto = new UserRequestDto();        userRequestDto.setEmail(email);        userRequestDto.setPassword(TempPassword);        userService.createSalesUser(userRequestDto);        try {            mailService.sendInviteEmail(email, TempPassword);        } catch (Exception e) {            throw new EmailDeliveryException(email);        }    }/*    public void acceptInvite(String token, UserRequestDto newUserRequest) {        // 1. Specific Exception for missing token        Invite invite = inviteRepository.findByToken(token)                .orElseThrow(() -> new InviteNotFoundException(token));        // 2. Specific Exception for expiry        if (invite.getExpiryDate().isBefore(LocalDateTime.now())) {            throw new InviteExpiredException(invite.getEmail());        }        // 3. Prevent double acceptance - NOW IT WORKS!        if (invite.getStatus() == InviteStatus.ACCEPTED) {            throw new InviteAlreadyAcceptedException();        }        invite.setStatus(InviteStatus.ACCEPTED);        inviteRepository.save(invite);        userService.createSalesUser(newUserRequest);    }    */}