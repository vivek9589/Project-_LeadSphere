package com.braininventory.leadsphere.user_service.service.impl;import com.braininventory.leadsphere.user_service.controller.InviteController;import com.braininventory.leadsphere.user_service.dto.InviteResponseDto;import com.braininventory.leadsphere.user_service.dto.UserRequestDto;import com.braininventory.leadsphere.user_service.entity.Invite;import com.braininventory.leadsphere.user_service.enums.InviteStatus;import com.braininventory.leadsphere.user_service.exception.*;import com.braininventory.leadsphere.user_service.repository.InviteRepository;import com.braininventory.leadsphere.user_service.repository.UserRepository;import com.braininventory.leadsphere.user_service.security.TokenGenerator;import com.braininventory.leadsphere.user_service.service.InviteService;import com.braininventory.leadsphere.user_service.service.MailService;import com.braininventory.leadsphere.user_service.service.UserService;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;import java.time.LocalDateTime;@Servicepublic class InviteServiceImpl implements InviteService {    private final InviteRepository inviteRepository;    private final TokenGenerator tokenGenerator;    private final UserService userService;    private final MailService mailService;    // Inject all dependencies via constructor    public InviteServiceImpl(InviteRepository inviteRepository,                             TokenGenerator tokenGenerator,                             UserService userService,                             MailService mailService) {        this.inviteRepository = inviteRepository;        this.tokenGenerator = tokenGenerator;        this.userService = userService;        this.mailService = mailService;    }    public void createInvite(InviteController.InviteRequest request) {        Object existingUser = userService.findByEmail(request.email());        if (existingUser != null) {            throw new DuplicateInviteException(request.email());        }        String tempPassword = tokenGenerator.generateTemporaryPassword();        Invite invite = new Invite();        invite.setEmail(request.email());        // invite.setFirstName(request.firstName()); // Ensure your Invite entity has this field        // invite.setLastName(request.lastName());   // Ensure your Invite entity has this field        invite.setPassword(tempPassword);        invite.setCreatedAt(LocalDateTime.now());        inviteRepository.save(invite);        UserRequestDto userRequestDto = new UserRequestDto();        userRequestDto.setEmail(request.email());        userRequestDto.setPassword(tempPassword);        userRequestDto.setFirstName(request.firstName()); // Pass to user service        userRequestDto.setLastName(request.lastName());        userService.createSalesUser(userRequestDto);        try {            // Now passing the first name to the email service            mailService.sendInviteEmail(request.email(), tempPassword, request.firstName());        } catch (Exception e) {            throw new EmailDeliveryException(request.email());        }    }}