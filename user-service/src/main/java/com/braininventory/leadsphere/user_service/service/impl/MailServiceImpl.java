package com.braininventory.leadsphere.user_service.service.impl;import com.braininventory.leadsphere.user_service.entity.User;import com.braininventory.leadsphere.user_service.repository.UserRepository;import com.braininventory.leadsphere.user_service.service.MailService;import com.braininventory.leadsphere.user_service.service.UserService;import jakarta.mail.MessagingException;import jakarta.mail.internet.MimeMessage;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.mail.javamail.JavaMailSender;import org.springframework.mail.javamail.MimeMessageHelper;import org.springframework.stereotype.Service;import org.thymeleaf.TemplateEngine;import org.thymeleaf.context.Context;@Servicepublic class MailServiceImpl implements MailService {    @Autowired    private UserRepository userRepository;    private final JavaMailSender mailSender;    private final TemplateEngine templateEngine;    @Autowired    public MailServiceImpl(JavaMailSender mailSender, TemplateEngine templateEngine) {        this.mailSender = mailSender;        this.templateEngine = templateEngine;    }    @Override    public void sendInviteEmail(String toEmail, String token) {        try {            String inviteLink = "http://localhost:8081/invites/accept?token=" + token;            Context context = new Context();            context.setVariable("inviteLink", inviteLink);            String htmlContent = templateEngine.process("invite-email", context);            MimeMessage mimeMessage = mailSender.createMimeMessage();            MimeMessageHelper helper = new MimeMessageHelper(mimeMessage, true, "UTF-8");            helper.setTo(toEmail);            helper.setSubject("You're invited to LeadSphere!");            helper.setText(htmlContent, true);            mailSender.send(mimeMessage);        } catch (Exception e) {            throw new RuntimeException("Failed to send invite email", e);        }    }    @Override    public void sendForgetPasswordEmail(String toEmail,String resetToken) {       // String resetLink = "http://localhost:8080/api-auth/reset-password?token=" + resetToken;        String resetLink = "http://localhost:5173/reset-password?token=" + resetToken;        //User user = userRepository.findByEmail(toEmail);        Context context = new Context();        //context.setVariable("username", user.getFirstName() + " " + user.getLastName());        context.setVariable("username", toEmail);        context.setVariable("resetLink", resetLink);        context.setVariable("expiryMinutes", 15);        String body = templateEngine.process("forget-password", context);        MimeMessage message = mailSender.createMimeMessage();        try {            MimeMessageHelper helper = new MimeMessageHelper(message, true);            helper.setTo(toEmail);            helper.setSubject("Password Reset Request");            helper.setText(body, true); // true = HTML            mailSender.send(message);        } catch (MessagingException e) {            throw new RuntimeException("Failed to send email", e);        }    }}